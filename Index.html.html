<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAQT Score Sheet</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th, td {
            border: 1px solid #000;
            padding: 5px;
            text-align: center;
            font-size: 0.9em;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        .player-check {
            width: 50px;
        }

        .bonus {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .bonus input[type="checkbox"], .player-check button {
            width: 20px;
            height: 20px;
            border: 2px solid black;
            background-color: white;
            cursor: pointer;
        }

        .divider {
            border-left: 5px solid black;
        }

        .score-total {
            font-weight: bold;
            font-size: 1.2em;
        }

        .settings {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .settings div {
            margin-right: 20px;
        }

        button {
            padding: 10px 20px;
            margin-top: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1em;
        }

        button:hover {
            background-color: #45a049;
        }

        /* Notes box styling */
        .notes-box {
            width: 100%;
            height: 30px;
        }

    </style>
</head>
<body>

    <h1>NAQT Score Sheet</h1>

    <!-- Tournament Details -->
    <div class="settings">
        <div>
            <label for="tournamentName">Tournament Name: </label>
            <input type="text" id="tournamentName" placeholder="Enter Tournament Name" style="width:200px;">
        </div>
        <div>
            <label for="roomNumber">Room Number: </label>
            <input type="text" id="roomNumber" placeholder="Enter Room Number" style="width:100px;">
        </div>
        <div>
            <label for="roundNumber">Round Number: </label>
            <input type="text" id="roundNumber" placeholder="Enter Round Number" style="width:100px;">
        </div>
    </div>

    <!-- Team names and Points Settings -->
    <div class="settings">
        <div>
            <label for="team1">Team 1 Name: </label>
            <input type="text" id="team1" class="team-name-input" placeholder="Enter Team 1 Name" style="width:150px;">
        </div>
        <div>
            <label for="powerVal">Power Value: </label>
            <input type="number" id="powerVal" value="15">
        </div>
        <div>
            <label for="tossupVal">Tossup Value: </label>
            <input type="number" id="tossupVal" value="10">
        </div>
        <div>
            <label for="bonusVal">Bonus Value: </label>
            <input type="number" id="bonusVal" value="10">
        </div>
        <div>
            <label for="negVal">Neg Value: </label>
            <input type="number" id="negVal" value="-5">
        </div>
        <div>
            <label for="team2">Team 2 Name: </label>
            <input type="text" id="team2" class="team-name-input" placeholder="Enter Team 2 Name" style="width:150px;">
        </div>
    </div>

    <!-- Score Sheet Table -->
    <table>
        <thead>
            <tr>
                <th>Tossup Number</th>

                <!-- Team 1 Player Columns -->
                <th><input type="text" id="player1_1" placeholder="Player 1"></th>
                <th><input type="text" id="player1_2" placeholder="Player 2"></th>
                <th><input type="text" id="player1_3" placeholder="Player 3"></th>
                <th><input type="text" id="player1_4" placeholder="Player 4"></th>
                <th>Bonuses</th>
                <th>Tossup + Bonus</th>
                <th>Cumulative Score</th>
                <th>Notes</th>
                <th class="divider"></th>
                <th>Cumulative Score</th>
                <th>Tossup + Bonus</th>
                <th>Bonuses</th>

                <!-- Team 2 Player Columns -->
                <th><input type="text" id="player2_1" placeholder="Player 1"></th>
                <th><input type="text" id="player2_2" placeholder="Player 2"></th>
                <th><input type="text" id="player2_3" placeholder="Player 3"></th>
                <th><input type="text" id="player2_4" placeholder="Player 4"></th>
            </tr>
        </thead>
        <tbody id="scoreSheetBody">
            <!-- Rows for Tossups (1-24) will be dynamically generated -->
        </tbody>

        <!-- Totals for Powers, Tossups, and Negs -->
        <tfoot>
            <tr>
                <td>Total Powers</td>
                <td id="totalPowers1_1">0</td>
                <td id="totalPowers1_2">0</td>
                <td id="totalPowers1_3">0</td>
                <td id="totalPowers1_4">0</td>
                <td></td><td></td><td></td><td></td>
                <td id="totalPowers2_1">0</td>
                <td id="totalPowers2_2">0</td>
                <td id="totalPowers2_3">0</td>
                <td id="totalPowers2_4">0</td>
            </tr>
            <tr>
                <td>Total Tossups</td>
                <td id="totalTossups1_1">0</td>
                <td id="totalTossups1_2">0</td>
                <td id="totalTossups1_3">0</td>
                <td id="totalTossups1_4">0</td>
                <td></td><td></td><td></td><td></td>
                <td id="totalTossups2_1">0</td>
                <td id="totalTossups2_2">0</td>
                <td id="totalTossups2_3">0</td>
                <td id="totalTossups2_4">0</td>
            </tr>
            <tr>
                <td>Total Negs</td>
                <td id="totalNegs1_1">0</td>
                <td id="totalNegs1_2">0</td>
                <td id="totalNegs1_3">0</td>
                <td id="totalNegs1_4">0</td>
                <td></td><td></td><td></td><td></td>
                <td id="totalNegs2_1">0</td>
                <td id="totalNegs2_2">0</td>
                <td id="totalNegs2_3">0</td>
                <td id="totalNegs2_4">0</td>
            </tr>
        </tfoot>
    </table>

    <button onclick="resetScores()">Reset Scores</button>
    <button onclick="exportToCSV()">Export Score Sheet</button>

    <script>
        const tossupCount = 24; // Number of tossups
        const scoreSheetBody = document.getElementById('scoreSheetBody');

        // Create score sheet rows for each tossup
        for (let i = 1; i <= tossupCount; i++) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${i}</td>

                <!-- Team 1 Player Checkboxes -->
                <td class="player-check"><button id="player1_${i}_1" onclick="cyclePlayerState(${i}, 1, 1)"></button></td>
                <td class="player-check"><button id="player1_${i}_2" onclick="cyclePlayerState(${i}, 1, 2)"></button></td>
                <td class="player-check"><button id="player1_${i}_3" onclick="cyclePlayerState(${i}, 1, 3)"></button></td>
                <td class="player-check"><button id="player1_${i}_4" onclick="cyclePlayerState(${i}, 1, 4)"></button></td>
                <td class="bonus">
                    <input type="checkbox" id="bonus1_${i}_1" onchange="updateScore(${i}, 1)">
                    <input type="checkbox" id="bonus1_${i}_2" onchange="updateScore(${i}, 1)">
                    <input type="checkbox" id="bonus1_${i}_3" onchange="updateScore(${i}, 1)">
                </td>
                <td id="tossupBonus1_${i}">0</td>
                <td id="cumulative1_${i}">0</td>
                <td><textarea class="notes-box" id="notes_${i}" placeholder="Add notes..."></textarea></td>
                <td class="divider"></td>
                <td id="cumulative2_${i}">0</td>
                <td id="tossupBonus2_${i}">0</td>
                <td class="bonus">
                    <input type="checkbox" id="bonus2_${i}_1" onchange="updateScore(${i}, 2)">
                    <input type="checkbox" id="bonus2_${i}_2" onchange="updateScore(${i}, 2)">
                    <input type="checkbox" id="bonus2_${i}_3" onchange="updateScore(${i}, 2)">
                </td>
                <td class="player-check"><button id="player2_${i}_1" onclick="cyclePlayerState(${i}, 2, 1)"></button></td>
                <td class="player-check"><button id="player2_${i}_2" onclick="cyclePlayerState(${i}, 2, 2)"></button></td>
                <td class="player-check"><button id="player2_${i}_3" onclick="cyclePlayerState(${i}, 2, 3)"></button></td>
                <td class="player-check"><button id="player2_${i}_4" onclick="cyclePlayerState(${i}, 2, 4)"></button></td>
            `;
            scoreSheetBody.appendChild(row);
        }

        // Function to cycle player state (power -> tossup -> neg)
        function cyclePlayerState(tossupNumber, team, player) {
            const button = document.getElementById(`player${team}_${tossupNumber}_${player}`);
            const currentColor = button.style.backgroundColor;

            if (currentColor === "green") {
                // Cycle to black (tossup)
                button.style.backgroundColor = "black";
            } else if (currentColor === "black") {
                // Cycle to red (neg)
                button.style.backgroundColor = "red";
            } else {
                // Default or no color, cycle to green (power)
                button.style.backgroundColor = "green";
            }

            updateScore(tossupNumber, team);
            updatePlayerTotals(team, player);
        }

        // Update player totals for powers, tossups, and negs
        function updatePlayerTotals(team, player) {
            let powers = 0, tossups = 0, negs = 0;
            for (let i = 1; i <= tossupCount; i++) {
                const button = document.getElementById(`player${team}_${i}_${player}`);
                const color = button.style.backgroundColor;
                if (color === "green") {
                    powers++;
                } else if (color === "black") {
                    tossups++;
                } else if (color === "red") {
                    negs++;
                }
            }
            document.getElementById(`totalPowers${team}_${player}`).innerText = powers;
            document.getElementById(`totalTossups${team}_${player}`).innerText = tossups;
            document.getElementById(`totalNegs${team}_${player}`).innerText = negs;
        }

        // Function to update cumulative score and total
        function updateScore(tossupNumber, team) {
            const powerValue = parseInt(document.getElementById('powerVal').value) || 0;
            const tossupValue = parseInt(document.getElementById('tossupVal').value) || 0;
            const bonusValue = parseInt(document.getElementById('bonusVal').value) || 0;
            const negValue = parseInt(document.getElementById('negVal').value) || 0;

            let tossupPoints = 0;

            // Loop through all players for this tossup
            for (let j = 1; j <= 4; j++) {
                const button = document.getElementById(`player${team}_${tossupNumber}_${j}`);
                const buttonColor = button.style.backgroundColor;

                if (buttonColor === "green") {
                    tossupPoints += powerValue;
                } else if (buttonColor === "black") {
                    tossupPoints += tossupValue;
                } else if (buttonColor === "red") {
                    tossupPoints += negValue;
                }
            }

            // Calculate bonus points
            let bonusPoints = 0;
            for (let j = 1; j <= 3; j++) {
                if (document.getElementById(`bonus${team}_${tossupNumber}_${j}`).checked) {
                    bonusPoints += bonusValue;
                }
            }

            // Update row total and cumulative score
            const rowTotal = tossupPoints + bonusPoints;
            document.getElementById(`tossupBonus${team}_${tossupNumber}`).innerText = rowTotal;

            let cumulativeScore = 0;
            for (let i = 1; i <= tossupCount; i++) {
                cumulativeScore += parseInt(document.getElementById(`tossupBonus${team}_${i}`).innerText) || 0;
            }
            document.getElementById(`cumulative${team}_${tossupNumber}`).innerText = cumulativeScore;
        }

        // Reset the entire score sheet
        function resetScores() {
            for (let i = 1; i <= tossupCount; i++) {
                for (let j = 1; j <= 4; j++) {
                    const button1 = document.getElementById(`player1_${i}_${j}`);
                    const button2 = document.getElementById(`player2_${i}_${j}`);
                    button1.style.backgroundColor = "white";
                    button2.style.backgroundColor = "white";
                }
                for (let j = 1; j <= 3; j++) {
                    document.getElementById(`bonus1_${i}_${j}`).checked = false;
                    document.getElementById(`bonus2_${i}_${j}`).checked = false;
                }
                document.getElementById(`tossupBonus1_${i}`).innerText = 0;
                document.getElementById(`tossupBonus2_${i}`).innerText = 0;
                document.getElementById(`cumulative1_${i}`).innerText = 0;
                document.getElementById(`cumulative2_${i}`).innerText = 0;
            }

            // Reset totals
            for (let player = 1; player <= 4; player++) {
                document.getElementById(`totalPowers1_${player}`).innerText = 0;
                document.getElementById(`totalTossups1_${player}`).innerText = 0;
                document.getElementById(`totalNegs1_${player}`).innerText = 0;
                document.getElementById(`totalPowers2_${player}`).innerText = 0;
                document.getElementById(`totalTossups2_${player}`).innerText = 0;
                document.getElementById(`totalNegs2_${player}`).innerText = 0;
            }

            // Clear notes
            for (let i = 1; i <= tossupCount; i++) {
                document.getElementById(`notes_${i}`).value = "";
            }
        }

        // Export the score sheet data to CSV
        function exportToCSV() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Tossup Number,Player 1 (Team 1),Player 2 (Team 1),Player 3 (Team 1),Player 4 (Team 1),Bonuses (Team 1),Tossup + Bonus (Team 1),Cumulative Score (Team 1),Notes,,Cumulative Score (Team 2),Tossup + Bonus (Team 2),Bonuses (Team 2),Player 1 (Team 2),Player 2 (Team 2),Player 3 (Team 2),Player 4 (Team 2)\n";

            for (let i = 1; i <= tossupCount; i++) {
                const row = [
                    i,
                    getPlayerStateForCSV(`player1_${i}_1`),
                    getPlayerStateForCSV(`player1_${i}_2`),
                    getPlayerStateForCSV(`player1_${i}_3`),
                    getPlayerStateForCSV(`player1_${i}_4`),
                    [
                        document.getElementById(`bonus1_${i}_1`).checked ? 1 : 0,
                        document.getElementById(`bonus1_${i}_2`).checked ? 1 : 0,
                        document.getElementById(`bonus1_${i}_3`).checked ? 1 : 0
                    ].join(", "),
                    document.getElementById(`tossupBonus1_${i}`).innerText,
                    document.getElementById(`cumulative1_${i}`).innerText,
                    document.getElementById(`notes_${i}`).value,
                    "",
                    document.getElementById(`cumulative2_${i}`).innerText,
                    document.getElementById(`tossupBonus2_${i}`).innerText,
                    [
                        document.getElementById(`bonus2_${i}_1`).checked ? 1 : 0,
                        document.getElementById(`bonus2_${i}_2`).checked ? 1 : 0,
                        document.getElementById(`bonus2_${i}_3`).checked ? 1 : 0
                    ].join(", "),
                    getPlayerStateForCSV(`player2_${i}_1`),
                    getPlayerStateForCSV(`player2_${i}_2`),
                    getPlayerStateForCSV(`player2_${i}_3`),
                    getPlayerStateForCSV(`player2_${i}_4`)
                ].join(",");

                csvContent += row + "\n";
            }

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "naqtscore.csv");
            document.body.appendChild(link);

            link.click();
        }

        // Helper function to get player state for CSV
        function getPlayerStateForCSV(buttonId) {
            const button = document.getElementById(buttonId);
            const color = button.style.backgroundColor;

            if (color === "green") {
                return "Power";
            } else if (color === "black") {
                return "Tossup";
            } else if (color === "red") {
                return "Neg";
            }
            return "";
        }
    </script>

</body>
</html>